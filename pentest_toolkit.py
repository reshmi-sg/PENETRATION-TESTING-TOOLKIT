import socket
import requests
import os
import time

# --------------------- MODULE 1: PORT SCANNER ---------------------
def port_scanner(host, ports=[21, 22, 23, 80, 443, 8080]):
    print(f"\n Scanning {host} for open ports...")
    for port in ports:
        try:
            with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
                s.settimeout(0.5)
                result = s.connect_ex((host, port))
                if result == 0:
                    print(f"[OPEN] Port {port} is open")
        except socket.error:
            print(f"[ERROR] Could not connect to {host}")
            return
    print(" Port scan complete.\n")

# --------------------- MODULE 2: BRUTE FORCE LOGIN ---------------------
def brute_force_login(url, username_list, password_list):
    print(f"\n Starting brute-force on {url}")
    for username in username_list:
        for password in password_list:
            response = requests.get(url, auth=(username, password))
            if response.status_code == 200:
                print(f"[SUCCESS] Username: {username} | Password: {password}")
                return
            else:
                print(f"[-] Failed: {username}:{password}")
    print(" Brute-force failed.\n")

# --------------------- MODULE 3: PING SWEEP ---------------------
def ping_sweep(ip_prefix):
    print(f"\n Running ping sweep on {ip_prefix}.0/24")
    for i in range(1, 5):  # Scanning only 4 hosts for demo
        ip = f"{ip_prefix}.{i}"
        response = os.system(f"ping -n 1 {ip} > nul" if os.name == 'nt' else f"ping -c 1 {ip} > /dev/null")
        if response == 0:
            print(f"[ACTIVE] Host is up: {ip}")
        else:
            print(f"[INACTIVE] Host down: {ip}")
    print(" Ping sweep complete.\n")

# --------------------- MODULE 4: WHOIS LOOKUP ---------------------
def whois_lookup(domain):
    print(f"\n WHOIS Lookup for {domain}")
    try:
        result = os.popen(f"whois {domain}").read()
        print(result[:500])  # Print first 500 chars
    except Exception as e:
        print(f"Error: {e}")
    print(" WHOIS lookup done.\n")

# --------------------- MAIN TOOL MENU ---------------------
def main():
    while True:
        print("\n=== Penetration Testing Toolkit ===")
        print("1. Port Scanner")
        print("2. Brute-Force Login (Basic Auth)")
        print("3. Ping Sweep (Local Subnet)")
        print("4. Whois Lookup")
        print("5. Exit")

        choice = input("Choose a module (1-5): ")

        if choice == '1':
            target = input("Enter host: ")
            port_scanner(target)

        elif choice == '2':
            url = input("Enter target login URL : ")
            usernames = ["admin", "user", "test"]
            passwords = ["admin", "1234", "password", "admin123"]
            brute_force_login(url, usernames, passwords)

        elif choice == '3':
            prefix = input("Enter IP prefix  ")
            ping_sweep(prefix)

        elif choice == '4':
            domain = input("Enter domain name : ")
            whois_lookup(domain)

        elif choice == '5':
            print("Exiting toolkit. ")
            break

        else:
            print("Invalid option. Try again.")

if __name__ == "__main__":
    main()
